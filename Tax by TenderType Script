Select TrxTransactionSaleItem.Total, TrxTransactionSaleItem.Tax, TrxTransactionPayment.ForeignCurrencyAmount, TrxTransactionPayment.ExchangeRate, TrxTransaction.ActualDate, TrxTransaction.TransactionId, RtlStore.Id As Store, PmtCurrency.Id As Currency, TrxTransactionSaleItem.Description, TrxTransactionSaleItem.Tax / TrxTransactionPayment.ExchangeRate As [forex tax] From TrxTransactionSaleItem Inner Join TrxTransactionPayment On TrxTransactionPayment.TransactionKey = TrxTransactionSaleItem.TransactionKey Inner Join TrxTransaction On TrxTransactionPayment.TransactionKey = TrxTransaction.TransactionKey Inner Join RtlStore On TrxTransaction.StoreKey = RtlStore.StoreKey Inner Join PmtCurrency On PmtCurrency.CurrencyKey = TrxTransactionPayment.CurrencyKey Where TrxTransaction.ActualDate Between Case When @FromDate = '' Then TrxTransaction.ActualDate Else Convert(DATETIME,@FromDate,112) End And Case When @ToDate = '' Then TrxTransaction.ActualDate Else Convert(DATETIME,@ToDate,112) End Group By TrxTransactionSaleItem.Total, TrxTransactionSaleItem.Tax, TrxTransactionPayment.ForeignCurrencyAmount, TrxTransactionPayment.ExchangeRate, TrxTransaction.ActualDate, TrxTransaction.TransactionId, RtlStore.Id, PmtCurrency.Id, TrxTransactionSaleItem.Description, TrxTransactionSaleItem.Tax / TrxTransactionPayment.ExchangeRate Having RtlStore.Id = Case When @Store = '' Then RtlStore.Id Else @Store End
